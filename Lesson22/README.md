# Идемпотентность

## Реализация

Для реализации идемпотентности используется метод версионирования коллекций.
При запросе `GET /api/orders` возвращается Header ETag - версия текущей коллекции. При вставке `POST /api/order` в Header If-Match необходимо передать значение ETag. Если значние If-Match не совпадает с текущим расчетным значнием, то это означает что коллекция была изменена и надо запросить новый ETag. Значение ETag сохраняется как OperationId в БД с уникальным индексом, что позволяет достичь более высокую степень защищенности от конкуретного изменения данных.

## Архитектура приложения

![architecture/schema.puml](https://www.plantuml.com/plantuml/proxy?fmt=svg&src=https://raw.githubusercontent.com/maxfire82/otus-microservices-course/main/Lesson22/architecture/schema.puml)

В качестве APIGateway используется Traefik.

Аутентификации реализована на основе JWT токена.

Сервис `Auth` осуществляет регистрацию и аутентификацию аккаунта пользователя.

Сервис `Users` осуществляет управление профилем пользователя. Запросы в сервис осуществляются только с JWT токеном.

Сервис `Orders` осуществляет управление заказами пользователя. Запросы в сервис осуществляются только с JWT токеном.

## Установка

Необходимо запустить скрипт `install.sh`

## Тестирование

Тесты лежат в папке `test`

```shell
newman run tests/orders.json
```